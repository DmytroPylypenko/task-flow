<div class="board-detail-container">
  @if (isLoading) {
  <p>Loading board...</p>
  } @else if (errorMessage) {
  <div class="error-message">
    <p>{{ errorMessage }}</p>
  </div>
  } @else if (board) {
  <div class="board-header">
    @if (isEditingTitle) {
    <div class="title-edit-form">
      <input
        type="text"
        [formControl]="titleControl"
        (keyup.enter)="saveTitle()"
        (keyup.escape)="cancelEditingTitle()"
        autofocus
      />
      <button (click)="saveTitle()">Save</button>
      <button (click)="cancelEditingTitle()">Cancel</button>
    </div>
    } @else {
    <h1>
      <span (click)="startEditingTitle()" class="editable-title" title="Click to edit">
        {{ board.name }}
      </span>
      <button class="delete-board-button" (click)="onDeleteBoard()" [disabled]="isLoading">
        Delete Board
      </button>
    </h1>
    }
  </div>

  <div class="columns-container" cdkDropListGroup>
    @for (column of board.columns; track column.id) {
    <div class="column">
      <h3>{{ column.name }}</h3>

      <form [formGroup]="newTaskForms.get(column.id)!" (ngSubmit)="onCreateTask(column)">
        <input type="text" formControlName="title" placeholder="New task..." />
        <button type="submit" [disabled]="newTaskForms.get(column.id)?.invalid">[+]</button>
      </form>

      <ul
        cdkDropList
        [id]="column.id.toString()"
        [cdkDropListData]="column.tasks"
        (cdkDropListDropped)="drop($event)"
      >
        @for (task of column.tasks; track task.id) {
        <li class="task-card" cdkDrag (click)="openTaskModal(task)">{{ task.title }}</li>
        } @empty {
        <p class="no-tasks">No tasks in this column.</p>
        }
      </ul>
    </div>
    }
  </div>
  }
</div>
